"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var observable_1 = require("data/observable");
var moment = require("moment");
var observable_property_decorator_1 = require("../../shared/observable-property-decorator");
var config_1 = require("../../config");
var frame_1 = require("ui/frame");
var TopicViewModel = /** @class */ (function (_super) {
    __extends(TopicViewModel, _super);
    function TopicViewModel(TopicPage, topicId, topicTitle) {
        var _this = _super.call(this) || this;
        _this.TopicPage = TopicPage;
        _this.topicId = topicId;
        _this.topicTitle = topicTitle;
        _this.title = "";
        _this.topicInfo = {};
        _this.topicReplies = [];
        _this.title = topicTitle;
        fetch(config_1.config.url + "t/topic/" + topicId + ".json").then(function (res) { return res.json(); })
            .then(function (res) {
            res.post_stream.posts = res.post_stream.posts.map(function (post) {
                post.created_at = moment(post.created_at).locale(config_1.config.language).fromNow();
                post.cooked = ("<html><head><base href=\"" + config_1.config.url + "\" target=\"_blank\"><style>a {\n                    background: #00ff9508;\n                    display: inline-block;\n                    margin: 5px;\n                    color: #0080d0;\n                    padding: 7px;\n                    border-radius: 5px;\n                    border: 3px solid #ffffffad;\n                    font-weight: bold;\n                    text-decoration: none;\n                    text-align: center;\n                }\n                * {\n                    direction: " + config_1.config.direction + ";\n                    font-size: 100%;\n                }\n                img {\n                    max-width: 100%;\n                    height: auto;\n                }\n                code,pre {\n                    direction: ltr !important;\n                    text-align: left !important;\n                }\n                pre code {\n                    display: block;\n                    padding: 5px 10px;\n                    color: #222;\n                    background: #f9f9f9;\n                    max-height: 500px;\n                    clear: both;\n                    overflow: auto;\n                }\n                img.emoji {\n                    width: 1em;\n                    min-width: 1em;\n                    max-width: 1em;\n                    margin-left: 2px;\n                    margin-right: 2px;\n                }\n                article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary {\n                    display: block;\n                }\n                aside.onebox {\n                    border: 5px solid #e9e9e9;\n                    padding: 12px 12px 12px 25px;\n                    font-size: 1em;\n                }\n                aside.onebox .onebox-body {\n                    clear: both;\n                }\n                aside.onebox .onebox-body [style*=\"--aspect-ratio\"] {\n                    position: relative;\n                }\n                .badge-notification.clicks {\n                    font-weight: normal;\n                    background-color: #e9e9e9;\n                    top: -1px;\n                    color: #919191;\n                    position: relative;\n                    margin-right: 2px;\n                    border: none;\n                }\n                aside.onebox .onebox-body h3, aside.onebox .onebox-body h4 {\n                    font-size: 1.17em;\n                    margin: 0 0 10px 0;\n                }\n                .quote .avatar{\n                    height: 1.25em !important;\n                    width: 1.25em !important;\n                    min-height: 0%;\n                    min-width: 0%;\n                    max-height: 100%;\n                    max-width: 100%;\n                    border-radius: 50%;\n                }\n                aside.quote .title {\n                    border-right: 5px solid #e9e9e9;\n                    background-color: #f9f9f9;\n                    color: #646464;\n                    padding: 12px 12px 1px 12px;\n                }\n                blockquote {\n                    margin-right: 0;\n                    margin-left: 0;\n                    padding: 12px;\n                    border-right: 5px solid #e9e9e9;\n                    background-color: #f9f9f9;\n                    clear: both;\n                }\n                aside.quote blockquote {\n                    margin-top: 0;\n                }</style></head><body>").trim()
                    + post.cooked + "</body></html>";
                if (post.avatar_template) {
                    if (post.avatar_template.indexOf('http') == -1) {
                        post.avatar_template = (config_1.config.url + "." + post.avatar_template.replace("{size}", "80")).replace('./', '');
                    }
                }
                return post;
            });
            var replies = JSON.parse(JSON.stringify(res.post_stream.posts));
            replies.shift();
            _this.topicInfo = res.post_stream.posts[0];
            _this.topicReplies = replies;
        });
        return _this;
    }
    TopicViewModel.prototype.close = function () {
        frame_1.topmost().goBack();
    };
    TopicViewModel.prototype.refresh = function () {
        var _this = this;
        this.topicInfo = {};
        this.topicReplies = [];
        fetch(config_1.config.url + "t/topic/" + this.topicId + ".json").then(function (res) { return res.json(); })
            .then(function (res) {
            res.post_stream.posts = res.post_stream.posts.map(function (post) {
                post.created_at = moment(post.created_at).locale(config_1.config.language).fromNow();
                post.cooked = ("<html><head><base href=\"" + config_1.config.url + "\" target=\"_blank\"><style>a {\n                    background: #00ff9508;\n                    display: inline-block;\n                    margin: 5px;\n                    color: #0080d0;\n                    padding: 7px;\n                    border-radius: 5px;\n                    border: 3px solid #ffffffad;\n                    font-weight: bold;\n                    text-decoration: none;\n                    text-align: center;\n                }\n                * {\n                    direction: " + config_1.config.direction + ";\n                    font-size: 100%;\n                }\n                img {\n                    max-width: 100%;\n                    height: auto;\n                }\n                code,pre {\n                    direction: ltr !important;\n                    text-align: left !important;\n                }\n                pre code {\n                    display: block;\n                    padding: 5px 10px;\n                    color: #222;\n                    background: #f9f9f9;\n                    max-height: 500px;\n                    clear: both;\n                    overflow: auto;\n                }\n                img.emoji {\n                    width: 1em;\n                    min-width: 1em;\n                    max-width: 1em;\n                    margin-left: 2px;\n                    margin-right: 2px;\n                }\n                article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary {\n                    display: block;\n                }\n                aside.onebox {\n                    border: 5px solid #e9e9e9;\n                    padding: 12px 12px 12px 25px;\n                    font-size: 1em;\n                }\n                aside.onebox .onebox-body {\n                    clear: both;\n                }\n                aside.onebox .onebox-body [style*=\"--aspect-ratio\"] {\n                    position: relative;\n                }\n                .badge-notification.clicks {\n                    font-weight: normal;\n                    background-color: #e9e9e9;\n                    top: -1px;\n                    color: #919191;\n                    position: relative;\n                    margin-right: 2px;\n                    border: none;\n                }\n                aside.onebox .onebox-body h3, aside.onebox .onebox-body h4 {\n                    font-size: 1.17em;\n                    margin: 0 0 10px 0;\n                }\n                .quote .avatar{\n                    height: 1.25em !important;\n                    width: 1.25em !important;\n                    min-height: 0%;\n                    min-width: 0%;\n                    max-height: 100%;\n                    max-width: 100%;\n                    border-radius: 50%;\n                }\n                aside.quote .title {\n                    border-right: 5px solid #e9e9e9;\n                    background-color: #f9f9f9;\n                    color: #646464;\n                    padding: 12px 12px 1px 12px;\n                }\n                blockquote {\n                    margin-right: 0;\n                    margin-left: 0;\n                    padding: 12px;\n                    border-right: 5px solid #e9e9e9;\n                    background-color: #f9f9f9;\n                    clear: both;\n                }\n                aside.quote blockquote {\n                    margin-top: 0;\n                }</style></head><body>").trim()
                    + post.cooked + "</body></html>";
                if (post.avatar_template) {
                    if (post.avatar_template.indexOf('http') == -1) {
                        post.avatar_template = (config_1.config.url + "." + post.avatar_template.replace("{size}", "80")).replace('./', '');
                    }
                }
                return post;
            });
            var replies = JSON.parse(JSON.stringify(res.post_stream.posts));
            replies.shift();
            _this.topicInfo = res.post_stream.posts[0];
            _this.topicReplies = replies;
        });
    };
    __decorate([
        observable_property_decorator_1.ObservableProperty(),
        __metadata("design:type", String)
    ], TopicViewModel.prototype, "title", void 0);
    __decorate([
        observable_property_decorator_1.ObservableProperty(),
        __metadata("design:type", Object)
    ], TopicViewModel.prototype, "topicInfo", void 0);
    __decorate([
        observable_property_decorator_1.ObservableProperty(),
        __metadata("design:type", Object)
    ], TopicViewModel.prototype, "topicReplies", void 0);
    return TopicViewModel;
}(observable_1.Observable));
exports.TopicViewModel = TopicViewModel;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9waWMtdmlldy1tb2RlbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInRvcGljLXZpZXctbW9kZWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSw4Q0FBNkM7QUFNN0MsK0JBQWtDO0FBQ2xDLDRGQUFnRjtBQUNoRix1Q0FBc0M7QUFDdEMsa0NBQW1DO0FBRW5DO0lBQW9DLGtDQUFVO0lBSzFDLHdCQUFtQixTQUFjLEVBQVMsT0FBYyxFQUFTLFVBQWlCO1FBQWxGLFlBQ0ksaUJBQU8sU0FzSFY7UUF2SGtCLGVBQVMsR0FBVCxTQUFTLENBQUs7UUFBUyxhQUFPLEdBQVAsT0FBTyxDQUFPO1FBQVMsZ0JBQVUsR0FBVixVQUFVLENBQU87UUFKckQsV0FBSyxHQUFVLEVBQUUsQ0FBQztRQUNsQixlQUFTLEdBQVUsRUFBRSxDQUFDO1FBQ3RCLGtCQUFZLEdBQUcsRUFBRSxDQUFDO1FBSTNDLEtBQUksQ0FBQyxLQUFLLEdBQUcsVUFBVSxDQUFDO1FBRXhCLEtBQUssQ0FBSSxlQUFNLENBQUMsR0FBRyxnQkFBVyxPQUFPLFVBQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFBLEdBQUcsSUFBSSxPQUFBLEdBQUcsQ0FBQyxJQUFJLEVBQUUsRUFBVixDQUFVLENBQUM7YUFDcEUsSUFBSSxDQUFDLFVBQUEsR0FBRztZQUNMLEdBQUcsQ0FBQyxXQUFXLENBQUMsS0FBSyxHQUFHLEdBQUcsQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxVQUFBLElBQUk7Z0JBRWxELElBQUksQ0FBQyxVQUFVLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxNQUFNLENBQUMsZUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDO2dCQUU1RSxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUEsOEJBQTJCLGVBQU0sQ0FBQyxHQUFHLDBnQkFhbEMsZUFBTSxDQUFDLFNBQVMsODVGQStFVixDQUFBLENBQUMsSUFBSSxF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LENBQUMsQ0FBQyxDQUFDO1lBQ2hFLE9BQU8sQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUVoQixLQUFJLENBQUMsU0FBUyxHQUFHLEdBQUcsQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzFDLEtBQUksQ0FBQyxZQUFZLEdBQUcsT0FBTyxDQUFDO1FBQ2hDLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQXhQcUI7UUFBckIsa0RBQWtCLEVBQUU7O2lEQUEwQjtJQUN6QjtRQUFyQixrREFBa0IsRUFBRTs7cURBQThCO0lBQzdCO1FBQXJCLGtEQUFrQixFQUFFOzt3REFBMEI7SUF1UG5ELHFCQUFDO0NBQUEsQUExUEQsQ0FBb0MsdUJBQVUsR0EwUDdDO0FBMVBZLHdDQUFjIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gXCJkYXRhL29ic2VydmFibGVcIjtcbmltcG9ydCB7IE9ic2VydmFibGVBcnJheSB9IGZyb20gXCJkYXRhL29ic2VydmFibGUtYXJyYXkvb2JzZXJ2YWJsZS1hcnJheVwiO1xuaW1wb3J0IHsgUGFnZSB9IGZyb20gJ3VpL3BhZ2UnO1xuaW1wb3J0IHsgV2ViVmlldyB9IGZyb20gJ3VpL3dlYi12aWV3JztcbmltcG9ydCB7IFJlcGVhdGVyIH0gZnJvbSAndWkvcmVwZWF0ZXInO1xuaW1wb3J0IHsgQWN0aXZpdHlJbmRpY2F0b3IgfSBmcm9tIFwidWkvYWN0aXZpdHktaW5kaWNhdG9yXCI7XG5pbXBvcnQgbW9tZW50ID0gcmVxdWlyZShcIm1vbWVudFwiKTtcbmltcG9ydCB7IE9ic2VydmFibGVQcm9wZXJ0eSB9IGZyb20gXCIuLi8uLi9zaGFyZWQvb2JzZXJ2YWJsZS1wcm9wZXJ0eS1kZWNvcmF0b3JcIjtcbmltcG9ydCB7IGNvbmZpZyB9IGZyb20gXCIuLi8uLi9jb25maWdcIjtcbmltcG9ydCB7IHRvcG1vc3QgfSBmcm9tIFwidWkvZnJhbWVcIjtcblxuZXhwb3J0IGNsYXNzIFRvcGljVmlld01vZGVsIGV4dGVuZHMgT2JzZXJ2YWJsZSB7XG4gICAgQE9ic2VydmFibGVQcm9wZXJ0eSgpIHB1YmxpYyB0aXRsZTpzdHJpbmcgPSBcIlwiO1xuICAgIEBPYnNlcnZhYmxlUHJvcGVydHkoKSBwdWJsaWMgdG9waWNJbmZvOm9iamVjdCA9IHt9O1xuICAgIEBPYnNlcnZhYmxlUHJvcGVydHkoKSBwdWJsaWMgdG9waWNSZXBsaWVzID0gW107XG5cbiAgICBjb25zdHJ1Y3RvcihwdWJsaWMgVG9waWNQYWdlOlBhZ2UsIHB1YmxpYyB0b3BpY0lkOm51bWJlciwgcHVibGljIHRvcGljVGl0bGU6c3RyaW5nKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMudGl0bGUgPSB0b3BpY1RpdGxlO1xuICAgICAgICBcbiAgICAgICAgZmV0Y2goYCR7Y29uZmlnLnVybH10L3RvcGljLyR7dG9waWNJZH0uanNvbmApLnRoZW4ocmVzID0+IHJlcy5qc29uKCkpXG4gICAgICAgIC50aGVuKHJlcyA9PntcbiAgICAgICAgICAgIHJlcy5wb3N0X3N0cmVhbS5wb3N0cyA9IHJlcy5wb3N0X3N0cmVhbS5wb3N0cy5tYXAocG9zdCA9PntcblxuICAgICAgICAgICAgICAgIHBvc3QuY3JlYXRlZF9hdCA9IG1vbWVudChwb3N0LmNyZWF0ZWRfYXQpLmxvY2FsZShjb25maWcubGFuZ3VhZ2UpLmZyb21Ob3coKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBwb3N0LmNvb2tlZCA9IGA8aHRtbD48aGVhZD48YmFzZSBocmVmPVwiJHtjb25maWcudXJsfVwiIHRhcmdldD1cIl9ibGFua1wiPjxzdHlsZT5hIHtcbiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZDogIzAwZmY5NTA4O1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7XG4gICAgICAgICAgICAgICAgICAgIG1hcmdpbjogNXB4O1xuICAgICAgICAgICAgICAgICAgICBjb2xvcjogIzAwODBkMDtcbiAgICAgICAgICAgICAgICAgICAgcGFkZGluZzogN3B4O1xuICAgICAgICAgICAgICAgICAgICBib3JkZXItcmFkaXVzOiA1cHg7XG4gICAgICAgICAgICAgICAgICAgIGJvcmRlcjogM3B4IHNvbGlkICNmZmZmZmZhZDtcbiAgICAgICAgICAgICAgICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7XG4gICAgICAgICAgICAgICAgICAgIHRleHQtZGVjb3JhdGlvbjogbm9uZTtcbiAgICAgICAgICAgICAgICAgICAgdGV4dC1hbGlnbjogY2VudGVyO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAqIHtcbiAgICAgICAgICAgICAgICAgICAgZGlyZWN0aW9uOiAke2NvbmZpZy5kaXJlY3Rpb259O1xuICAgICAgICAgICAgICAgICAgICBmb250LXNpemU6IDEwMCU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGltZyB7XG4gICAgICAgICAgICAgICAgICAgIG1heC13aWR0aDogMTAwJTtcbiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBhdXRvO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb2RlLHByZSB7XG4gICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogbHRyICFpbXBvcnRhbnQ7XG4gICAgICAgICAgICAgICAgICAgIHRleHQtYWxpZ246IGxlZnQgIWltcG9ydGFudDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcHJlIGNvZGUge1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiBibG9jaztcbiAgICAgICAgICAgICAgICAgICAgcGFkZGluZzogNXB4IDEwcHg7XG4gICAgICAgICAgICAgICAgICAgIGNvbG9yOiAjMjIyO1xuICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZjlmOWY5O1xuICAgICAgICAgICAgICAgICAgICBtYXgtaGVpZ2h0OiA1MDBweDtcbiAgICAgICAgICAgICAgICAgICAgY2xlYXI6IGJvdGg7XG4gICAgICAgICAgICAgICAgICAgIG92ZXJmbG93OiBhdXRvO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpbWcuZW1vamkge1xuICAgICAgICAgICAgICAgICAgICB3aWR0aDogMWVtO1xuICAgICAgICAgICAgICAgICAgICBtaW4td2lkdGg6IDFlbTtcbiAgICAgICAgICAgICAgICAgICAgbWF4LXdpZHRoOiAxZW07XG4gICAgICAgICAgICAgICAgICAgIG1hcmdpbi1sZWZ0OiAycHg7XG4gICAgICAgICAgICAgICAgICAgIG1hcmdpbi1yaWdodDogMnB4O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBhcnRpY2xlLCBhc2lkZSwgZGV0YWlscywgZmlnY2FwdGlvbiwgZmlndXJlLCBmb290ZXIsIGhlYWRlciwgaGdyb3VwLCBtYWluLCBuYXYsIHNlY3Rpb24sIHN1bW1hcnkge1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiBibG9jaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYXNpZGUub25lYm94IHtcbiAgICAgICAgICAgICAgICAgICAgYm9yZGVyOiA1cHggc29saWQgI2U5ZTllOTtcbiAgICAgICAgICAgICAgICAgICAgcGFkZGluZzogMTJweCAxMnB4IDEycHggMjVweDtcbiAgICAgICAgICAgICAgICAgICAgZm9udC1zaXplOiAxZW07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGFzaWRlLm9uZWJveCAub25lYm94LWJvZHkge1xuICAgICAgICAgICAgICAgICAgICBjbGVhcjogYm90aDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYXNpZGUub25lYm94IC5vbmVib3gtYm9keSBbc3R5bGUqPVwiLS1hc3BlY3QtcmF0aW9cIl0ge1xuICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC5iYWRnZS1ub3RpZmljYXRpb24uY2xpY2tzIHtcbiAgICAgICAgICAgICAgICAgICAgZm9udC13ZWlnaHQ6IG5vcm1hbDtcbiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogI2U5ZTllOTtcbiAgICAgICAgICAgICAgICAgICAgdG9wOiAtMXB4O1xuICAgICAgICAgICAgICAgICAgICBjb2xvcjogIzkxOTE5MTtcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IHJlbGF0aXZlO1xuICAgICAgICAgICAgICAgICAgICBtYXJnaW4tcmlnaHQ6IDJweDtcbiAgICAgICAgICAgICAgICAgICAgYm9yZGVyOiBub25lO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBhc2lkZS5vbmVib3ggLm9uZWJveC1ib2R5IGgzLCBhc2lkZS5vbmVib3ggLm9uZWJveC1ib2R5IGg0IHtcbiAgICAgICAgICAgICAgICAgICAgZm9udC1zaXplOiAxLjE3ZW07XG4gICAgICAgICAgICAgICAgICAgIG1hcmdpbjogMCAwIDEwcHggMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLnF1b3RlIC5hdmF0YXJ7XG4gICAgICAgICAgICAgICAgICAgIGhlaWdodDogMS4yNWVtICFpbXBvcnRhbnQ7XG4gICAgICAgICAgICAgICAgICAgIHdpZHRoOiAxLjI1ZW0gIWltcG9ydGFudDtcbiAgICAgICAgICAgICAgICAgICAgbWluLWhlaWdodDogMCU7XG4gICAgICAgICAgICAgICAgICAgIG1pbi13aWR0aDogMCU7XG4gICAgICAgICAgICAgICAgICAgIG1heC1oZWlnaHQ6IDEwMCU7XG4gICAgICAgICAgICAgICAgICAgIG1heC13aWR0aDogMTAwJTtcbiAgICAgICAgICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNTAlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBhc2lkZS5xdW90ZSAudGl0bGUge1xuICAgICAgICAgICAgICAgICAgICBib3JkZXItcmlnaHQ6IDVweCBzb2xpZCAjZTllOWU5O1xuICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjlmOWY5O1xuICAgICAgICAgICAgICAgICAgICBjb2xvcjogIzY0NjQ2NDtcbiAgICAgICAgICAgICAgICAgICAgcGFkZGluZzogMTJweCAxMnB4IDFweCAxMnB4O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBibG9ja3F1b3RlIHtcbiAgICAgICAgICAgICAgICAgICAgbWFyZ2luLXJpZ2h0OiAwO1xuICAgICAgICAgICAgICAgICAgICBtYXJnaW4tbGVmdDogMDtcbiAgICAgICAgICAgICAgICAgICAgcGFkZGluZzogMTJweDtcbiAgICAgICAgICAgICAgICAgICAgYm9yZGVyLXJpZ2h0OiA1cHggc29saWQgI2U5ZTllOTtcbiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogI2Y5ZjlmOTtcbiAgICAgICAgICAgICAgICAgICAgY2xlYXI6IGJvdGg7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGFzaWRlLnF1b3RlIGJsb2NrcXVvdGUge1xuICAgICAgICAgICAgICAgICAgICBtYXJnaW4tdG9wOiAwO1xuICAgICAgICAgICAgICAgIH08L3N0eWxlPjwvaGVhZD48Ym9keT5gLnRyaW0oKVxuICAgICAgICAgICAgKyBwb3N0LmNvb2tlZCArIGA8L2JvZHk+PC9odG1sPmA7XG5cbiAgICAgICAgICAgICAgICBpZihwb3N0LmF2YXRhcl90ZW1wbGF0ZSl7XG4gICAgICAgICAgICAgICAgICAgIGlmKHBvc3QuYXZhdGFyX3RlbXBsYXRlLmluZGV4T2YoJ2h0dHAnKSA9PSAtMSl7XG4gICAgICAgICAgICAgICAgICAgICAgICBwb3N0LmF2YXRhcl90ZW1wbGF0ZSA9IChjb25maWcudXJsICsgXCIuXCIgKyBwb3N0LmF2YXRhcl90ZW1wbGF0ZS5yZXBsYWNlKFwie3NpemV9XCIsXCI4MFwiKSkucmVwbGFjZSgnLi8nLCcnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gcG9zdDtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBsZXQgcmVwbGllcyA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkocmVzLnBvc3Rfc3RyZWFtLnBvc3RzKSk7XG4gICAgICAgICAgICByZXBsaWVzLnNoaWZ0KCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHRoaXMudG9waWNJbmZvID0gcmVzLnBvc3Rfc3RyZWFtLnBvc3RzWzBdO1xuICAgICAgICAgICAgdGhpcy50b3BpY1JlcGxpZXMgPSByZXBsaWVzO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgY2xvc2UoKXtcbiAgICAgICAgdG9wbW9zdCgpLmdvQmFjaygpO1xuICAgIH1cblxuICAgIHB1YmxpYyByZWZyZXNoKCl7XG4gICAgICAgIHRoaXMudG9waWNJbmZvID0ge307XG4gICAgICAgIHRoaXMudG9waWNSZXBsaWVzID0gW107XG4gICAgICAgIFxuICAgICAgICBmZXRjaChgJHtjb25maWcudXJsfXQvdG9waWMvJHt0aGlzLnRvcGljSWR9Lmpzb25gKS50aGVuKHJlcyA9PiByZXMuanNvbigpKVxuICAgICAgICAudGhlbihyZXMgPT57XG4gICAgICAgICAgICByZXMucG9zdF9zdHJlYW0ucG9zdHMgPSByZXMucG9zdF9zdHJlYW0ucG9zdHMubWFwKHBvc3QgPT57XG5cbiAgICAgICAgICAgICAgICBwb3N0LmNyZWF0ZWRfYXQgPSBtb21lbnQocG9zdC5jcmVhdGVkX2F0KS5sb2NhbGUoY29uZmlnLmxhbmd1YWdlKS5mcm9tTm93KCk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgcG9zdC5jb29rZWQgPSBgPGh0bWw+PGhlYWQ+PGJhc2UgaHJlZj1cIiR7Y29uZmlnLnVybH1cIiB0YXJnZXQ9XCJfYmxhbmtcIj48c3R5bGU+YSB7XG4gICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6ICMwMGZmOTUwODtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrO1xuICAgICAgICAgICAgICAgICAgICBtYXJnaW46IDVweDtcbiAgICAgICAgICAgICAgICAgICAgY29sb3I6ICMwMDgwZDA7XG4gICAgICAgICAgICAgICAgICAgIHBhZGRpbmc6IDdweDtcbiAgICAgICAgICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNXB4O1xuICAgICAgICAgICAgICAgICAgICBib3JkZXI6IDNweCBzb2xpZCAjZmZmZmZmYWQ7XG4gICAgICAgICAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiBib2xkO1xuICAgICAgICAgICAgICAgICAgICB0ZXh0LWRlY29yYXRpb246IG5vbmU7XG4gICAgICAgICAgICAgICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKiB7XG4gICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogJHtjb25maWcuZGlyZWN0aW9ufTtcbiAgICAgICAgICAgICAgICAgICAgZm9udC1zaXplOiAxMDAlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpbWcge1xuICAgICAgICAgICAgICAgICAgICBtYXgtd2lkdGg6IDEwMCU7XG4gICAgICAgICAgICAgICAgICAgIGhlaWdodDogYXV0bztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29kZSxwcmUge1xuICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb246IGx0ciAhaW1wb3J0YW50O1xuICAgICAgICAgICAgICAgICAgICB0ZXh0LWFsaWduOiBsZWZ0ICFpbXBvcnRhbnQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHByZSBjb2RlIHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogYmxvY2s7XG4gICAgICAgICAgICAgICAgICAgIHBhZGRpbmc6IDVweCAxMHB4O1xuICAgICAgICAgICAgICAgICAgICBjb2xvcjogIzIyMjtcbiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZDogI2Y5ZjlmOTtcbiAgICAgICAgICAgICAgICAgICAgbWF4LWhlaWdodDogNTAwcHg7XG4gICAgICAgICAgICAgICAgICAgIGNsZWFyOiBib3RoO1xuICAgICAgICAgICAgICAgICAgICBvdmVyZmxvdzogYXV0bztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaW1nLmVtb2ppIHtcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDFlbTtcbiAgICAgICAgICAgICAgICAgICAgbWluLXdpZHRoOiAxZW07XG4gICAgICAgICAgICAgICAgICAgIG1heC13aWR0aDogMWVtO1xuICAgICAgICAgICAgICAgICAgICBtYXJnaW4tbGVmdDogMnB4O1xuICAgICAgICAgICAgICAgICAgICBtYXJnaW4tcmlnaHQ6IDJweDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYXJ0aWNsZSwgYXNpZGUsIGRldGFpbHMsIGZpZ2NhcHRpb24sIGZpZ3VyZSwgZm9vdGVyLCBoZWFkZXIsIGhncm91cCwgbWFpbiwgbmF2LCBzZWN0aW9uLCBzdW1tYXJ5IHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogYmxvY2s7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGFzaWRlLm9uZWJveCB7XG4gICAgICAgICAgICAgICAgICAgIGJvcmRlcjogNXB4IHNvbGlkICNlOWU5ZTk7XG4gICAgICAgICAgICAgICAgICAgIHBhZGRpbmc6IDEycHggMTJweCAxMnB4IDI1cHg7XG4gICAgICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogMWVtO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBhc2lkZS5vbmVib3ggLm9uZWJveC1ib2R5IHtcbiAgICAgICAgICAgICAgICAgICAgY2xlYXI6IGJvdGg7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGFzaWRlLm9uZWJveCAub25lYm94LWJvZHkgW3N0eWxlKj1cIi0tYXNwZWN0LXJhdGlvXCJdIHtcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IHJlbGF0aXZlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAuYmFkZ2Utbm90aWZpY2F0aW9uLmNsaWNrcyB7XG4gICAgICAgICAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiBub3JtYWw7XG4gICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICNlOWU5ZTk7XG4gICAgICAgICAgICAgICAgICAgIHRvcDogLTFweDtcbiAgICAgICAgICAgICAgICAgICAgY29sb3I6ICM5MTkxOTE7XG4gICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgICAgICAgICAgICAgICAgICAgbWFyZ2luLXJpZ2h0OiAycHg7XG4gICAgICAgICAgICAgICAgICAgIGJvcmRlcjogbm9uZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYXNpZGUub25lYm94IC5vbmVib3gtYm9keSBoMywgYXNpZGUub25lYm94IC5vbmVib3gtYm9keSBoNCB7XG4gICAgICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogMS4xN2VtO1xuICAgICAgICAgICAgICAgICAgICBtYXJnaW46IDAgMCAxMHB4IDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC5xdW90ZSAuYXZhdGFye1xuICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDEuMjVlbSAhaW1wb3J0YW50O1xuICAgICAgICAgICAgICAgICAgICB3aWR0aDogMS4yNWVtICFpbXBvcnRhbnQ7XG4gICAgICAgICAgICAgICAgICAgIG1pbi1oZWlnaHQ6IDAlO1xuICAgICAgICAgICAgICAgICAgICBtaW4td2lkdGg6IDAlO1xuICAgICAgICAgICAgICAgICAgICBtYXgtaGVpZ2h0OiAxMDAlO1xuICAgICAgICAgICAgICAgICAgICBtYXgtd2lkdGg6IDEwMCU7XG4gICAgICAgICAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDUwJTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYXNpZGUucXVvdGUgLnRpdGxlIHtcbiAgICAgICAgICAgICAgICAgICAgYm9yZGVyLXJpZ2h0OiA1cHggc29saWQgI2U5ZTllOTtcbiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogI2Y5ZjlmOTtcbiAgICAgICAgICAgICAgICAgICAgY29sb3I6ICM2NDY0NjQ7XG4gICAgICAgICAgICAgICAgICAgIHBhZGRpbmc6IDEycHggMTJweCAxcHggMTJweDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYmxvY2txdW90ZSB7XG4gICAgICAgICAgICAgICAgICAgIG1hcmdpbi1yaWdodDogMDtcbiAgICAgICAgICAgICAgICAgICAgbWFyZ2luLWxlZnQ6IDA7XG4gICAgICAgICAgICAgICAgICAgIHBhZGRpbmc6IDEycHg7XG4gICAgICAgICAgICAgICAgICAgIGJvcmRlci1yaWdodDogNXB4IHNvbGlkICNlOWU5ZTk7XG4gICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICNmOWY5Zjk7XG4gICAgICAgICAgICAgICAgICAgIGNsZWFyOiBib3RoO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBhc2lkZS5xdW90ZSBibG9ja3F1b3RlIHtcbiAgICAgICAgICAgICAgICAgICAgbWFyZ2luLXRvcDogMDtcbiAgICAgICAgICAgICAgICB9PC9zdHlsZT48L2hlYWQ+PGJvZHk+YC50cmltKClcbiAgICAgICAgICAgICsgcG9zdC5jb29rZWQgKyBgPC9ib2R5PjwvaHRtbD5gO1xuXG4gICAgICAgICAgICAgICAgaWYocG9zdC5hdmF0YXJfdGVtcGxhdGUpe1xuICAgICAgICAgICAgICAgICAgICBpZihwb3N0LmF2YXRhcl90ZW1wbGF0ZS5pbmRleE9mKCdodHRwJykgPT0gLTEpe1xuICAgICAgICAgICAgICAgICAgICAgICAgcG9zdC5hdmF0YXJfdGVtcGxhdGUgPSAoY29uZmlnLnVybCArIFwiLlwiICsgcG9zdC5hdmF0YXJfdGVtcGxhdGUucmVwbGFjZShcIntzaXplfVwiLFwiODBcIikpLnJlcGxhY2UoJy4vJywnJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHBvc3Q7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgbGV0IHJlcGxpZXMgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHJlcy5wb3N0X3N0cmVhbS5wb3N0cykpO1xuICAgICAgICAgICAgcmVwbGllcy5zaGlmdCgpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICB0aGlzLnRvcGljSW5mbyA9IHJlcy5wb3N0X3N0cmVhbS5wb3N0c1swXTtcbiAgICAgICAgICAgIHRoaXMudG9waWNSZXBsaWVzID0gcmVwbGllcztcbiAgICAgICAgfSk7XG4gICAgfVxufVxuIl19