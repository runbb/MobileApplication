"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var observable_1 = require("data/observable");
var moment = require("moment");
var observable_property_decorator_1 = require("../../shared/observable-property-decorator");
var config_1 = require("../../config");
var TopicViewModel = /** @class */ (function (_super) {
    __extends(TopicViewModel, _super);
    function TopicViewModel(TopicPage, topicId, topicTitle) {
        var _this = _super.call(this) || this;
        _this.TopicPage = TopicPage;
        _this.topicId = topicId;
        _this.topicTitle = topicTitle;
        _this.title = "";
        _this.topicInfo = new observable_1.Observable();
        _this.topicReplies = [];
        _this.title = topicTitle;
        fetch(config_1.config.url + "t/topic/" + topicId + ".json").then(function (res) { return res.json(); })
            .then(function (res) {
            var topicView = TopicPage.getViewById("topicView");
            topicView.src = "<style>a {\n                    background: #00ff9508;\n                    display: block;\n                    margin: 5px;\n                    color: #0080d0;\n                    padding: 7px;\n                    border-radius: 5px;\n                    border: 3px solid #ffffffad;\n                    font-weight: bold;\n                    text-decoration: none;\n                    text-align: center;\n                }\n                * {\n                    direction: rtl;\n                    font-size: 100%;\n                }\n                img {\n                    width: 100%;\n                    min-width: 100%;\n                    max-width: 100%;\n                    height: auto;\n                }\n                code,pre {\n                    word-wrap: break-word;\n                    direction: ltr !important;\n                    text-align: left !important;\n                }\n                pre code {\n                    display: block;\n                    padding: 5px 10px;\n                    color: #222;\n                    background: #f9f9f9;\n                    max-height: 500px;\n                }\n                img.emoji {\n                    width: 1em;\n                    min-width: 1em;\n                    max-width: 1em;\n                    margin-left: 2px;\n                    margin-right: 2px;\n                }\n                article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary {\n                    display: block;\n                }\n                aside.onebox {\n                    border: 5px solid #e9e9e9;\n                    padding: 12px 12px 12px 25px;\n                    font-size: 1em;\n                }\n                aside.onebox .onebox-body {\n                    clear: both;\n                }\n                aside.onebox .onebox-body [style*=\"--aspect-ratio\"] {\n                    position: relative;\n                }\n                .badge-notification.clicks {\n                    font-weight: normal;\n                    background-color: #e9e9e9;\n                    top: -1px;\n                    color: #919191;\n                    position: relative;\n                    margin-right: 2px;\n                    border: none;\n                }\n                aside.onebox .onebox-body h3, aside.onebox .onebox-body h4 {\n                    font-size: 1.17em;\n                    margin: 0 0 10px 0;\n                }</style>".trim()
                + res.post_stream.posts[0].cooked;
            res.post_stream.posts = res.post_stream.posts.map(function (post) {
                post.created_at = moment(post.created_at).locale("ar").fromNow();
                if (post.avatar_template) {
                    if (post.avatar_template.indexOf('http') == -1) {
                        post.avatar_template = (config_1.config.url + "." + post.avatar_template.replace("{size}", "80")).replace('./', '');
                    }
                }
                return post;
            });
            var replies = res.post_stream.posts;
            replies.shift();
            _this.topicInfo = res.post_stream.posts[0];
            _this.topicReplies = replies;
        });
        return _this;
    }
    __decorate([
        observable_property_decorator_1.ObservableProperty(),
        __metadata("design:type", String)
    ], TopicViewModel.prototype, "title", void 0);
    __decorate([
        observable_property_decorator_1.ObservableProperty(),
        __metadata("design:type", observable_1.Observable)
    ], TopicViewModel.prototype, "topicInfo", void 0);
    __decorate([
        observable_property_decorator_1.ObservableProperty(),
        __metadata("design:type", Object)
    ], TopicViewModel.prototype, "topicReplies", void 0);
    return TopicViewModel;
}(observable_1.Observable));
exports.TopicViewModel = TopicViewModel;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9waWMtdmlldy1tb2RlbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInRvcGljLXZpZXctbW9kZWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSw4Q0FBNkM7QUFNN0MsK0JBQWtDO0FBQ2xDLDRGQUFnRjtBQUNoRix1Q0FBc0M7QUFFdEM7SUFBb0Msa0NBQVU7SUFJMUMsd0JBQW1CLFNBQWMsRUFBUyxPQUFjLEVBQVMsVUFBaUI7UUFBbEYsWUFDSSxpQkFBTyxTQTZGVjtRQTlGa0IsZUFBUyxHQUFULFNBQVMsQ0FBSztRQUFTLGFBQU8sR0FBUCxPQUFPLENBQU87UUFBUyxnQkFBVSxHQUFWLFVBQVUsQ0FBTztRQUhyRCxXQUFLLEdBQVUsRUFBRSxDQUFDO1FBQ2xCLGVBQVMsR0FBYyxJQUFJLHVCQUFVLEVBQUUsQ0FBQztRQUN4QyxrQkFBWSxHQUFHLEVBQUUsQ0FBQztRQUczQyxLQUFJLENBQUMsS0FBSyxHQUFHLFVBQVUsQ0FBQztRQUN4QixLQUFLLENBQUksZUFBTSxDQUFDLEdBQUcsZ0JBQVcsT0FBTyxVQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBQSxHQUFHLElBQUksT0FBQSxHQUFHLENBQUMsSUFBSSxFQUFFLEVBQVYsQ0FBVSxDQUFDO2FBQ3BFLElBQUksQ0FBQyxVQUFBLEdBQUc7WUFDTCxJQUFJLFNBQVMsR0FBVyxTQUFTLENBQUMsV0FBVyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQzNELFNBQVMsQ0FBQyxHQUFHLEdBQUcsbTlFQW1FRixDQUFDLElBQUksRUFBRTtrQkFDbkIsR0FBRyxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDO1lBRWxDLEdBQUcsQ0FBQyxXQUFXLENBQUMsS0FBSyxHQUFHLEdBQUcsQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxVQUFBLElBQUk7Z0JBRWxELElBQUksQ0FBQyxVQUFVLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsT0FBTyxFQUFFLENBQUM7Z0JBRWpFLEVBQUUsQ0FBQSxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQSxDQUFDO29CQUNyQixFQUFFLENBQUEsQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFBLENBQUM7d0JBQzNDLElBQUksQ0FBQyxlQUFlLEdBQUcsQ0FBQyxlQUFNLENBQUMsR0FBRyxHQUFHLEdBQUcsR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLE9BQU8sQ0FBQyxRQUFRLEVBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFDLEVBQUUsQ0FBQyxDQUFDO29CQUM3RyxDQUFDO2dCQUNMLENBQUM7Z0JBQ0QsTUFBTSxDQUFDLElBQUksQ0FBQztZQUNoQixDQUFDLENBQUMsQ0FBQztZQUVILElBQUksT0FBTyxHQUFHLEdBQUcsQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDO1lBQ3BDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUNoQixLQUFJLENBQUMsU0FBUyxHQUFHLEdBQUcsQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzFDLEtBQUksQ0FBQyxZQUFZLEdBQUcsT0FBTyxDQUFDO1FBRWhDLENBQUMsQ0FBQyxDQUFDOztJQUNQLENBQUM7SUFqR3FCO1FBQXJCLGtEQUFrQixFQUFFOztpREFBMEI7SUFDekI7UUFBckIsa0RBQWtCLEVBQUU7a0NBQWtCLHVCQUFVO3FEQUFvQjtJQUMvQztRQUFyQixrREFBa0IsRUFBRTs7d0RBQTBCO0lBZ0duRCxxQkFBQztDQUFBLEFBbkdELENBQW9DLHVCQUFVLEdBbUc3QztBQW5HWSx3Q0FBYyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tIFwiZGF0YS9vYnNlcnZhYmxlXCI7XG5pbXBvcnQgeyBPYnNlcnZhYmxlQXJyYXkgfSBmcm9tIFwiZGF0YS9vYnNlcnZhYmxlLWFycmF5L29ic2VydmFibGUtYXJyYXlcIjtcbmltcG9ydCB7IFBhZ2UgfSBmcm9tICd1aS9wYWdlJztcbmltcG9ydCB7IFdlYlZpZXcgfSBmcm9tICd1aS93ZWItdmlldyc7XG5pbXBvcnQgeyBSZXBlYXRlciB9IGZyb20gJ3VpL3JlcGVhdGVyJztcbmltcG9ydCB7IEFjdGl2aXR5SW5kaWNhdG9yIH0gZnJvbSBcInVpL2FjdGl2aXR5LWluZGljYXRvclwiO1xuaW1wb3J0IG1vbWVudCA9IHJlcXVpcmUoXCJtb21lbnRcIik7XG5pbXBvcnQgeyBPYnNlcnZhYmxlUHJvcGVydHkgfSBmcm9tIFwiLi4vLi4vc2hhcmVkL29ic2VydmFibGUtcHJvcGVydHktZGVjb3JhdG9yXCI7XG5pbXBvcnQgeyBjb25maWcgfSBmcm9tIFwiLi4vLi4vY29uZmlnXCI7XG5cbmV4cG9ydCBjbGFzcyBUb3BpY1ZpZXdNb2RlbCBleHRlbmRzIE9ic2VydmFibGUge1xuICAgIEBPYnNlcnZhYmxlUHJvcGVydHkoKSBwdWJsaWMgdGl0bGU6c3RyaW5nID0gXCJcIjtcbiAgICBAT2JzZXJ2YWJsZVByb3BlcnR5KCkgcHVibGljIHRvcGljSW5mbzpPYnNlcnZhYmxlID0gbmV3IE9ic2VydmFibGUoKTtcbiAgICBAT2JzZXJ2YWJsZVByb3BlcnR5KCkgcHVibGljIHRvcGljUmVwbGllcyA9IFtdO1xuICAgIGNvbnN0cnVjdG9yKHB1YmxpYyBUb3BpY1BhZ2U6UGFnZSwgcHVibGljIHRvcGljSWQ6bnVtYmVyLCBwdWJsaWMgdG9waWNUaXRsZTpzdHJpbmcpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy50aXRsZSA9IHRvcGljVGl0bGU7XG4gICAgICAgIGZldGNoKGAke2NvbmZpZy51cmx9dC90b3BpYy8ke3RvcGljSWR9Lmpzb25gKS50aGVuKHJlcyA9PiByZXMuanNvbigpKVxuICAgICAgICAudGhlbihyZXMgPT57XG4gICAgICAgICAgICBsZXQgdG9waWNWaWV3OldlYlZpZXcgPSBUb3BpY1BhZ2UuZ2V0Vmlld0J5SWQoXCJ0b3BpY1ZpZXdcIik7XG4gICAgICAgICAgICB0b3BpY1ZpZXcuc3JjID0gYDxzdHlsZT5hIHtcbiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZDogIzAwZmY5NTA4O1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiBibG9jaztcbiAgICAgICAgICAgICAgICAgICAgbWFyZ2luOiA1cHg7XG4gICAgICAgICAgICAgICAgICAgIGNvbG9yOiAjMDA4MGQwO1xuICAgICAgICAgICAgICAgICAgICBwYWRkaW5nOiA3cHg7XG4gICAgICAgICAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDVweDtcbiAgICAgICAgICAgICAgICAgICAgYm9yZGVyOiAzcHggc29saWQgI2ZmZmZmZmFkO1xuICAgICAgICAgICAgICAgICAgICBmb250LXdlaWdodDogYm9sZDtcbiAgICAgICAgICAgICAgICAgICAgdGV4dC1kZWNvcmF0aW9uOiBub25lO1xuICAgICAgICAgICAgICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICoge1xuICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb246IHJ0bDtcbiAgICAgICAgICAgICAgICAgICAgZm9udC1zaXplOiAxMDAlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpbWcge1xuICAgICAgICAgICAgICAgICAgICB3aWR0aDogMTAwJTtcbiAgICAgICAgICAgICAgICAgICAgbWluLXdpZHRoOiAxMDAlO1xuICAgICAgICAgICAgICAgICAgICBtYXgtd2lkdGg6IDEwMCU7XG4gICAgICAgICAgICAgICAgICAgIGhlaWdodDogYXV0bztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29kZSxwcmUge1xuICAgICAgICAgICAgICAgICAgICB3b3JkLXdyYXA6IGJyZWFrLXdvcmQ7XG4gICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogbHRyICFpbXBvcnRhbnQ7XG4gICAgICAgICAgICAgICAgICAgIHRleHQtYWxpZ246IGxlZnQgIWltcG9ydGFudDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcHJlIGNvZGUge1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiBibG9jaztcbiAgICAgICAgICAgICAgICAgICAgcGFkZGluZzogNXB4IDEwcHg7XG4gICAgICAgICAgICAgICAgICAgIGNvbG9yOiAjMjIyO1xuICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZjlmOWY5O1xuICAgICAgICAgICAgICAgICAgICBtYXgtaGVpZ2h0OiA1MDBweDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaW1nLmVtb2ppIHtcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDFlbTtcbiAgICAgICAgICAgICAgICAgICAgbWluLXdpZHRoOiAxZW07XG4gICAgICAgICAgICAgICAgICAgIG1heC13aWR0aDogMWVtO1xuICAgICAgICAgICAgICAgICAgICBtYXJnaW4tbGVmdDogMnB4O1xuICAgICAgICAgICAgICAgICAgICBtYXJnaW4tcmlnaHQ6IDJweDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYXJ0aWNsZSwgYXNpZGUsIGRldGFpbHMsIGZpZ2NhcHRpb24sIGZpZ3VyZSwgZm9vdGVyLCBoZWFkZXIsIGhncm91cCwgbWFpbiwgbmF2LCBzZWN0aW9uLCBzdW1tYXJ5IHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogYmxvY2s7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGFzaWRlLm9uZWJveCB7XG4gICAgICAgICAgICAgICAgICAgIGJvcmRlcjogNXB4IHNvbGlkICNlOWU5ZTk7XG4gICAgICAgICAgICAgICAgICAgIHBhZGRpbmc6IDEycHggMTJweCAxMnB4IDI1cHg7XG4gICAgICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogMWVtO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBhc2lkZS5vbmVib3ggLm9uZWJveC1ib2R5IHtcbiAgICAgICAgICAgICAgICAgICAgY2xlYXI6IGJvdGg7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGFzaWRlLm9uZWJveCAub25lYm94LWJvZHkgW3N0eWxlKj1cIi0tYXNwZWN0LXJhdGlvXCJdIHtcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IHJlbGF0aXZlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAuYmFkZ2Utbm90aWZpY2F0aW9uLmNsaWNrcyB7XG4gICAgICAgICAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiBub3JtYWw7XG4gICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICNlOWU5ZTk7XG4gICAgICAgICAgICAgICAgICAgIHRvcDogLTFweDtcbiAgICAgICAgICAgICAgICAgICAgY29sb3I6ICM5MTkxOTE7XG4gICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgICAgICAgICAgICAgICAgICAgbWFyZ2luLXJpZ2h0OiAycHg7XG4gICAgICAgICAgICAgICAgICAgIGJvcmRlcjogbm9uZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYXNpZGUub25lYm94IC5vbmVib3gtYm9keSBoMywgYXNpZGUub25lYm94IC5vbmVib3gtYm9keSBoNCB7XG4gICAgICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogMS4xN2VtO1xuICAgICAgICAgICAgICAgICAgICBtYXJnaW46IDAgMCAxMHB4IDA7XG4gICAgICAgICAgICAgICAgfTwvc3R5bGU+YC50cmltKClcbiAgICAgICAgICAgICsgcmVzLnBvc3Rfc3RyZWFtLnBvc3RzWzBdLmNvb2tlZDtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgcmVzLnBvc3Rfc3RyZWFtLnBvc3RzID0gcmVzLnBvc3Rfc3RyZWFtLnBvc3RzLm1hcChwb3N0ID0+e1xuXG4gICAgICAgICAgICAgICAgcG9zdC5jcmVhdGVkX2F0ID0gbW9tZW50KHBvc3QuY3JlYXRlZF9hdCkubG9jYWxlKFwiYXJcIikuZnJvbU5vdygpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGlmKHBvc3QuYXZhdGFyX3RlbXBsYXRlKXtcbiAgICAgICAgICAgICAgICAgICAgaWYocG9zdC5hdmF0YXJfdGVtcGxhdGUuaW5kZXhPZignaHR0cCcpID09IC0xKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvc3QuYXZhdGFyX3RlbXBsYXRlID0gKGNvbmZpZy51cmwgKyBcIi5cIiArIHBvc3QuYXZhdGFyX3RlbXBsYXRlLnJlcGxhY2UoXCJ7c2l6ZX1cIixcIjgwXCIpKS5yZXBsYWNlKCcuLycsJycpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBwb3N0O1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGxldCByZXBsaWVzID0gcmVzLnBvc3Rfc3RyZWFtLnBvc3RzO1xuICAgICAgICAgICAgcmVwbGllcy5zaGlmdCgpO1xuICAgICAgICAgICAgdGhpcy50b3BpY0luZm8gPSByZXMucG9zdF9zdHJlYW0ucG9zdHNbMF07XG4gICAgICAgICAgICB0aGlzLnRvcGljUmVwbGllcyA9IHJlcGxpZXM7XG5cbiAgICAgICAgfSk7XG4gICAgfVxufVxuIl19